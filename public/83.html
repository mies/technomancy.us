<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1' />
    <title>inte-gray-shun - Technomancy</title>
    <script src="/static/prototype.js" type="text/javascript"></script>

    <link href="http://technomancy.us/feed/atom" rel="alternate" type="application/atom+xml"/>
    <link rel='stylesheet' href='/static/style.css' type='text/css' />
  </head>

  <body>

    <div id='background'>
      <img src='/static/i/top.png' alt='Technomancy' border='0' id='corner' />

      <div id='wrapper'> &nbsp;

      <div id='nav'>
        <ul>
          <li><a href='/'>blog</a></li>
          <li><a href='/resume'>r&eacute;sum&eacute;</a></li>
          <li><a href='/contact'>contact</a></li>
          <li><a href='/meta'>meta</a></li>
          <li><a href='http://dev.technomancy.us'>projects</a></li>
        </ul>

      </div><!-- end nav -->

      <p id='tagline'>Any sufficiently advanced technology is indistinguishable from magic.</p>

      <div id='content'>
        <h2>{ blog }</h2><div id='sidebar'>

        <h3>What you say?</h3>

        <p class='explain'>These are the technology musings of Phil
        Hagelberg. I write Ruby and Javascript code for a living, but I also spend a lot of
        time considering how to do so in the most efficient manner. This
        necessarily involves good-sized chunks of Emacs lisp.</p>

        <p class='explain'>I've got a separate <a href="http://philisha.net">blog for
        personal thoughts</a> and a <a href="http://dev.technomancy.us">wiki</a>
        for my projects.</p>

        <form action='http://www.google.com/search' name='searchbox' method='get'>
          <input type='hidden' name='sitesearch' value='technomancy.us' />
          <input type='text' name='q' size='9' value='Search' class='form-text'
                 onfocus="if (this.value=='Search') value='';"
                 onblur="if (this.value=='') value='Search';" />
          <input type='submit' value='&#187;' class='button' title="Because I didn't want to code search myself" />
        </form>

        <p><a href='/feed/atom' title='Syndication is your friend'><img src='/static/i/feedIcon.png' alt='feed' align='left' /> Feed</a></p>

        <h3>Fellow Hackers</h3>
        <ul>
          <li><a href='http://arko.net/' rel='friend met colleague'>andr&eacute; arko</a></li>
          <li><a href='http://brainspl.at' rel='friend met colleague'>ezra Z</a></li>
          <li><a href='http://blog.livollmers.net/' rel='friend colleague met'>alex</a></li>
          <li><a href='http://userprimary.net/user' rel='frient colleague met'>seth</a></li>
          <li><a href='http://www.lathi.net' rel='friend colleague met'>doug alcorn</a></li>
          <li><a href='http://blog.hasmanythrough.com' rel='friend colleague met'>josh susser</a></li>
          <li><a href='http://yehudakatz.com'>katz</a></li>
          <li><a href='http://evil.che.lu' rel='friend colleague'>evilchelu</a></li>
          <li><a href='http://jw.fi' rel='friend colleague'>unfo-</a></li>
          <li><a href='http://metaatem.com' rel='friend colleague met'>kastner</a></li>
          <li><a href='http://www.anarchaia.org/'>anarchaia</a></li>
          <li><a href='http://blog.codahale.com' rel='friend colleague met'>coda hale</a></li>
          <li><a href='http://gilesbowkett.blogspot.com' rel='colleague'>giles bowkett</a></li>
          <li><a href='http://on-ruby.blogspot.com/' rel='colleague met'>pate</a></li>
          <li><a href='http://schneier.com/blog' title='SecurityInsight'>bruce schneier</a></li>
          <li><a href='http://tbray.org/ongoing' rel='met' title='t1m'>tim bray</a></li>
          <li><a href='http://diveintomark.org'>mark pilgrim</a></li>
          <li><a href='http://intertwingly.net'>sam ruby</a></li>
          <li><a href='http://hackety.org' rel='met'>hackety</a></li>
          <li><a href='http://redhanded.hobix.com/' rel='met' title='Lucky Stiff and Friends'>redHanded</a></li>
          <li><a href='http://eigenclass.org' title="maybe if i read this more often i'll get smarter and understand it">mauricio</a></li>
          <li><a href='http://onestepback.org' title='the santa claus of Ruby'>jim weirich</a></li>
          <li><a href='http://ejohn.org'>john resig</a></li>
          <li><a href='http://steve-yegge.blogspot.com/' title='mostly he is listed because of emacs'>steve yegge</a></li>
        </ul>

        <h3 title='aggregation is key here'>Communities</h3>
        <ul>
          <li><a href='http://planet.lisp.org' title="(grok 'lisp)">planet lisp</a></li>
          <li><a href='http://planet.emacsen.org' title='denizens of #emacs'>planet emacs</a></li>
          <li><a href='http://planetruby.0x42.net' title='Yes, it runs on Python'>planet ruby</a></li>
          <li><a href='http://planet.caboo.se' title='my latest planet'>planet caboose</a></li>
          <li><a href='http://planet.ubuntu.com' title='humanity'>planet ubuntu</a></li>
          <li><a href='http://planet.mozilla.org' title='Gecko will save us'>planet mozilla</a></li>
          <li><a href='http://radar.oreilly.com/' title='there are those that call me... tim'>planet o'reilly</a></li>
        </ul>

        <h3><a href='http://dev.technomancy.us/'>Projects</a></h3>
        <ul>
          <li><a href='http://bus-scheme.rubyforge.org'>bus scheme</a></li>
          <li><a href='http://augment.rubyforge.org'>augment</a></li>
          <li><a href='http://www.emacswiki.org/cgi-bin/wiki/ElUnit' title='Emacs Lisp TDD'>elunit</a></li>
          <li><a href='http://rinari.rubyforge.org' title='rails emacs mode'>rinari</a></li>
          <li><a href='http://concour.se' title='railsday 06 project'>Concourse</a></li>
          <li><a href='http://rubyforge.org/projects/rplanet' title='Feed Aggregator'>rPlanet</a></li>
          <li><a href='http://rav.rubyforge.org/' title='Rails Application Visualizer'>rav</a></li>
          <li><a href='http://cartographer.rubyforge.org' title='Google Maps in Rails'>Cartographer</a></li>
          <li><a href='http://dev.technomancy.us/ebby' title='collaborative editing with Emacs'>ebby</a></li>
        </ul>

      </div><!-- end sidebar -->

      <div class='post'>
        <h3><a href='/83'>inte-gray-shun</a></h3>

        <div>
          <p>So I've been playing around with some more of this new-fangled "desktop integration" stuff. Pretty crazy.</p>

<img src='/static/i/portland_street.jpg' alt='portland street' />

<p>Recently the ever-useful gaim project was <a href='http://pidgin.im'>renamed to pidgin</a>. The new release is quite nice, but several plugins haven't really been ported over yet. On top of that, the notification plugin has some <a href='https://bugs.launchpad.net/ubuntu/+source/gaim/+bug/93638'>serious problems</a> on 64-bit machines. How troublesome! Of course, you can always scratch your itches by writing plugins in Python or C, but then you have to use Python or C.</p>

<p>Well it turns out if you take advantage of <a href='http://dbus.freedesktop.org'>dbus</a>, the whole plugin architecture with its limited language support becomes a bit of a non-issue. The <a href='https://trac.luon.net/ruby-dbus/'>ruby-dbus</a> project helps out here admirably. I should note that there's a proliferation of projects purporting to allow dbus usage from within Ruby, but this one seemed the most mature and active. I was also very impressed by the quick response on the mailing list I got from the developers when I found a problem.</p>

<pre class='code'>
  <span class="keyword">def</span> <span class="function-name">watch_status</span>
    <span class="variable-name">@purple</span>.on_signal(<span class="string">"AccountStatusChanged"</span>) <span class="keyword">do</span> |account, old, new|
      <span class="keyword">begin</span>
        <span class="type">TwitterClient</span>.update(current_message) <span class="keyword">unless</span> current_message == <span class="string">''</span>
      <span class="keyword">rescue</span> <span class="type">Twitter</span>::<span class="type">RESTError</span> =&gt; re
        puts re
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function-name">notify_messages</span>
    <span class="variable-name">@purple</span>.on_signal(<span class="string">"ReceivedImMsg"</span>) <span class="keyword">do</span> |account, user, message|
      message.gsub!(<span class="string">/\&lt;[^\&gt;]*\&gt;/</span>, <span class="string">''</span>) <span class="comment-delimiter"># </span><span class="comment">jabber messages have unnecessary XML
</span>      user = user.split(<span class="string">/\//</span>).first <span class="comment-delimiter"># </span><span class="comment">get rid of jabber resource part
</span>      <span class="type">Notify</span>.send(<span class="constant">:message</span> =&gt; message, <span class="constant">:title</span> =&gt; <span class="string">"</span><span class="variable-name">#{user}</span><span class="string"> says:"</span>,
                  <span class="constant">:seconds</span> =&gt; 5,
                  <span class="constant">:icon</span> =&gt; (<span class="type">File</span>.expand_path(<span class="string">"~/.purple/icons/"</span>) + <span class="string">'/'</span>
                            + <span class="variable-name">@buddy_icons</span>[user] <span class="keyword">if</span> <span class="variable-name">@buddy_icons</span>[user]))
      <span class="type">ThinkLight</span>.flash
      sleep 0.2
      <span class="type">ThinkLight</span>.flash
    <span class="keyword">end</span>
  <span class="keyword">end</span></pre>

<p>So far it does a few things:</p>
<ul>
<li>listens for changes in my IM status and posts them to <a href='http://twitter.com/technomancy'>Twitter</a></li>
<li>pops up a notification bubble on incoming messages (with buddy icons)</li>
<li>flashes the light on my laptop when a message is received</li>
</ul>

<p>Not what you'd call exciting, but the point is it's written in Ruby and thus easily extensible by myself. Instant messaging has been the lone holdout in terms of the daily tasks that I was unable to automate and tie into programmatically, so it's good to see that taken care of.</p>

<p>Code is <a href='http://dev.technomancy.us/browser/dotfiles/bin/pidgin-tools.rb'>in Trac</a> as usual.</p>
        </div>

        <p class='dt'>
          <a href='/83'>Sat Oct 13 00:00:01 -0700 2007</a>
        </p>
      </div>
    </div>

    <p id='foot'>
      &copy; 2004 - 2007 Phil Hagelberg <span title='soli Deo gloria'>SDG</span>
    </p>

  </div><!-- end wrapper -->
  <img src='/static/i/foot.png' alt='' id='corner' style='display: block;' />

</div><!-- end background -->


</body></html>
