<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1' />
    <title>darjeeling - a roundabout route - Technomancy</title>
    <script src="/static/prototype.js" type="text/javascript"></script>

    <link href="http://technomancy.us/feed/atom" rel="alternate" type="application/atom+xml"/>
    <link rel='stylesheet' href='/static/style.css' type='text/css' />
  </head>

  <body>

    <div id='background'>
      <img src='/static/i/top.png' alt='Technomancy' border='0' id='corner' />

      <div id='wrapper'> &nbsp;

      <div id='nav'>
        <ul>
          <li><a href='/'>blog</a></li>
          <li><a href='/resume'>r&eacute;sum&eacute;</a></li>
          <li><a href='/contact'>contact</a></li>
          <li><a href='/meta'>meta</a></li>
          <li><a href='http://dev.technomancy.us'>projects</a></li>
        </ul>

      </div><!-- end nav -->

      <p id='tagline'>Any sufficiently advanced technology is indistinguishable from magic.</p>

      <div id='content'>
        <h2>{ blog }</h2><div id='sidebar'>

        <h3>What you say?</h3>

        <p class='explain'>These are the technology musings of Phil
        Hagelberg. I write Ruby and Javascript code for a living, but I also spend a lot of
        time considering how to do so in the most efficient manner. This
        necessarily involves good-sized chunks of Emacs lisp.</p>

        <p class='explain'>I've got a separate <a href="http://philisha.net">blog for
        personal thoughts</a> and a <a href="http://dev.technomancy.us">wiki</a>
        for my projects.</p>

        <form action='http://www.google.com/search' name='searchbox' method='get'>
          <input type='hidden' name='sitesearch' value='technomancy.us' />
          <input type='text' name='q' size='9' value='Search' class='form-text'
                 onfocus="if (this.value=='Search') value='';"
                 onblur="if (this.value=='') value='Search';" />
          <input type='submit' value='&#187;' class='button' title="Because I didn't want to code search myself" />
        </form>

        <p><a href='/feed/atom' title='Syndication is your friend'><img src='/static/i/feedIcon.png' alt='feed' align='left' /> Feed</a></p>

        <h3>Fellow Hackers</h3>
        <ul>
          <li><a href='http://arko.net/' rel='friend met colleague'>andr&eacute; arko</a></li>
          <li><a href='http://brainspl.at' rel='friend met colleague'>ezra Z</a></li>
          <li><a href='http://blog.livollmers.net/' rel='friend colleague met'>alex</a></li>
          <li><a href='http://userprimary.net/user' rel='frient colleague met'>seth</a></li>
          <li><a href='http://www.lathi.net' rel='friend colleague met'>doug alcorn</a></li>
          <li><a href='http://blog.hasmanythrough.com' rel='friend colleague met'>josh susser</a></li>
          <li><a href='http://yehudakatz.com'>katz</a></li>
          <li><a href='http://evil.che.lu' rel='friend colleague'>evilchelu</a></li>
          <li><a href='http://jw.fi' rel='friend colleague'>unfo-</a></li>
          <li><a href='http://metaatem.com' rel='friend colleague met'>kastner</a></li>
          <li><a href='http://www.anarchaia.org/'>anarchaia</a></li>
          <li><a href='http://blog.codahale.com' rel='friend colleague met'>coda hale</a></li>
          <li><a href='http://gilesbowkett.blogspot.com' rel='colleague'>giles bowkett</a></li>
          <li><a href='http://on-ruby.blogspot.com/' rel='colleague met'>pate</a></li>
          <li><a href='http://schneier.com/blog' title='SecurityInsight'>bruce schneier</a></li>
          <li><a href='http://tbray.org/ongoing' rel='met' title='t1m'>tim bray</a></li>
          <li><a href='http://diveintomark.org'>mark pilgrim</a></li>
          <li><a href='http://intertwingly.net'>sam ruby</a></li>
          <li><a href='http://hackety.org' rel='met'>hackety</a></li>
          <li><a href='http://redhanded.hobix.com/' rel='met' title='Lucky Stiff and Friends'>redHanded</a></li>
          <li><a href='http://eigenclass.org' title="maybe if i read this more often i'll get smarter and understand it">mauricio</a></li>
          <li><a href='http://onestepback.org' title='the santa claus of Ruby'>jim weirich</a></li>
          <li><a href='http://ejohn.org'>john resig</a></li>
          <li><a href='http://steve-yegge.blogspot.com/' title='mostly he is listed because of emacs'>steve yegge</a></li>
        </ul>

        <h3 title='aggregation is key here'>Communities</h3>
        <ul>
          <li><a href='http://planet.lisp.org' title="(grok 'lisp)">planet lisp</a></li>
          <li><a href='http://planet.emacsen.org' title='denizens of #emacs'>planet emacs</a></li>
          <li><a href='http://planetruby.0x42.net' title='Yes, it runs on Python'>planet ruby</a></li>
          <li><a href='http://planet.caboo.se' title='my latest planet'>planet caboose</a></li>
          <li><a href='http://planet.ubuntu.com' title='humanity'>planet ubuntu</a></li>
          <li><a href='http://planet.mozilla.org' title='Gecko will save us'>planet mozilla</a></li>
          <li><a href='http://radar.oreilly.com/' title='there are those that call me... tim'>planet o'reilly</a></li>
        </ul>

        <h3><a href='http://dev.technomancy.us/'>Projects</a></h3>
        <ul>
          <li><a href='http://bus-scheme.rubyforge.org'>bus scheme</a></li>
          <li><a href='http://augment.rubyforge.org'>augment</a></li>
          <li><a href='http://www.emacswiki.org/cgi-bin/wiki/ElUnit' title='Emacs Lisp TDD'>elunit</a></li>
          <li><a href='http://rinari.rubyforge.org' title='rails emacs mode'>rinari</a></li>
          <li><a href='http://concour.se' title='railsday 06 project'>Concourse</a></li>
          <li><a href='http://rubyforge.org/projects/rplanet' title='Feed Aggregator'>rPlanet</a></li>
          <li><a href='http://rav.rubyforge.org/' title='Rails Application Visualizer'>rav</a></li>
          <li><a href='http://cartographer.rubyforge.org' title='Google Maps in Rails'>Cartographer</a></li>
          <li><a href='http://dev.technomancy.us/ebby' title='collaborative editing with Emacs'>ebby</a></li>
        </ul>

      </div><!-- end sidebar -->

      <div class='post'>
        <h3><a href='/72'>darjeeling - a roundabout route</a></h3>

        <div>
          <p>Well by now if you follow Ruby much you've probably noticed the
  whole <a
  href="http://on-ruby.blogspot.com/2007/01/will-rubinius-be-acceptable-lisp.html">Will Rubinius
  be an acceptable Lisp</a> ponderings or brainstormings or whatever you want to
  call it. And if you know me at all, you'd be aware that the
  union of such concepts is exactly the kind of thing that would
  excite me.</p>

<p>So I meddled around a bit
  with <a
  href="http://parsetree.rubyforge.org">ParseTree</a>. Honestly, it's
  ridiculous; the Ruby side of this kind of thing has been made more
  or less trivial by Ryan's great work:</p>

  <pre class='code'>
require <span class="string">'rubygems'</span>
require <span class="string">'parse_tree'</span>

<span class="keyword">class</span> <span class="type">Infuser</span>
  <span class="keyword">def</span> <span class="function-name">self.brew</span>(klass)
    lisp(<span class="type">ParseTree</span>.new.parse_tree(klass)).sub(<span class="string">/\(\(/</span>, <span class="string">'(class Object ('</span>)
</span>  <span class="keyword">end</span>

  <span class="keyword">def</span> <span class="function-name">self.lisp</span>(leaf)
    leaf.respond_to?(<span class="constant">:map</span>) ? <span class="string">"(</span><span class="variable-name">#{leaf.map{|l| lisp(l)}</span><span class="string">.join(' ')})"</span> : leaf
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre>

<p>Would you look at that. Like I said; pretty trivial. While we're on the subject of trivial, consider this:</p>

  <pre class='code'>
<span class="keyword">class</span> <span class="type">Foo</span>
  <span class="keyword">def</span> <span class="function-name">bar</span>
    1 + 1
  <span class="keyword">end</span>
<span class="keyword">end</span></pre>


<p><code>Infuser.brew Foo</code> gives us this:</p>

<pre class='code'>
(<span class="keyword">class</span> <span class="type">Object</span>
       (<span class="keyword">class</span> <span class="type">Foo</span> (const <span class="type">Object</span>) 
	      (<span class="keyword">defn</span> bar 
		(<span class="keyword">scope</span>
		 (<span class="keyword">block</span> (args) 
		   (<span class="keyword">call</span> (lit 1) + (array (lit 1))))))))
</pre>

<p>At this point you may be tempted to think yourself, "Hey, that
  looks like lisp! Run it through the compiler and see what it does."
  Unfortunately Ruby's object model is wildly divergent from Common
  Lisp's. (Though you could say that's very fortunate depending on
  your opinion of <acronym title="Common Lisp Object System">CLOS</acronym>&mdash;I won't go there.) The point is, running
  the above code would require getting a subset of Ruby's object model
  running in Common Lisp. Running nontrivial code would basically require
  getting it completely ported.</p>

<p>Now that sounds hugely daunting task. It probably is. But I've got
  this wild idea that you'd only have to actually implement a fairly
  small subset of this in CL itself. The rest could be translated over
  from Ruby. I'm thinking all the portions of the
  implementation currently written in C would need to be redone in CL,
  and if the port is accurate enough then the portions of Ruby-the-implementation which are written
  in Ruby-the-language will be able to be translated through the infuser shown
  above. Now I know that the official Ruby has gobs and gobs of stuff
  implemented in C, but it seems to be a stated goal
  of <a href="http://rubini.us/rubinius">Rubinius</a> to decrease the
  C-to-Ruby ratio. That may be something that could be leveraged
  here. (Note to self: need to check out MetaRuby as well.)</p>

<p>There's another hiccup though&mdash;it seems there's no solid
  <acronym title="Behaviour-Driven Development">BDD</acronym>
  framework for Common Lisp. A few weeks back I started
  writing <a
  href="http://dev.technomancy.us/phil/browser/dotfiles/.emacs.d/behave">behave.el</a>
  for Emacs Lisp. The pieces are all coming together in my head, so it
  seems the thing to do at this point would be to finish it, port it
  to CL, and then start porting the Rubinius specs to it.</p>

<p>If this sounds totally insane to you, you're probably right. If it
  doesn't, (or if it's the kind of insanity that intrigues you, and
  you can't bring yourself to take your eyes away from such a wreck of an idea)
  hop on the mailing list; I've got
  a <a href="http://rubyforge.org/projects/darjeeling">project</a> set
  up at RubyForge. It's called Darjeeling.</p>

        </div>

        <p class='dt'>
          <a href='/72'>Sat Oct 13 00:00:01 -0700 2007</a>
        </p>
      </div>
    </div>

    <p id='foot'>
      &copy; 2004 - 2007 Phil Hagelberg <span title='soli Deo gloria'>SDG</span>
    </p>

  </div><!-- end wrapper -->
  <img src='/static/i/foot.png' alt='' id='corner' style='display: block;' />

</div><!-- end background -->


</body></html>
