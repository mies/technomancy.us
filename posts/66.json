{"timestamp": "Sat Oct 13 00: 00: 01 -0700 2007", "title": "how i learned to stop worrying and love^H^H^H^H tolerate ecmascript", "id": 66, "content": "<style>\ntable {\n  border-collapse:  collapse;\n  padding:  0;\n}\nth,  td {\n  padding:  .1em .3em;\n  white-space:  nowrap;\n}\n\nth { \n     font-size:  80%;\n     width:  4.5em;\n}\n\ntd.deselected-time\n{ \n  background-color:  #BBCCEE;\n  border:  1px #3f8591 solid;\n}\n\ntd.selected-time\n{ \n  border:  1px #3f8591 solid;\n  background-color:  #DDEEFF;\n}\n</style>\n\n<p>I know,  I know,  this has\n  been <a href='http: //technomancy.us/blog/post/48'>long\n  overdue</a>. But I've finally bit the bullet and dove into enough\n  Javascript to get <a href='/sample/concourse'>Concourse</a> all\n  shiny and slick. There have been a few other new features,  but the\n  big thing that this new version brings is a usable hour selection\n  widget: </p>\n\n<table        onmousedown=\"clickWeek(event);\"\n       onmousemove=\"moveWeek(event);\"\n       onmouseup=\"releaseWeek(event);\"\n              id=\"week1\">\n  <thead>\n    <tr><th>&nbsp;</th>\n\n      \t<th>Nov 26</th>\n    \t<th>Nov 27</th>\n\n    \t<th>Nov 28</th>\n    \t<th>Nov 29</th>\n    \t<th>Nov 30</th>\n    </tr>\n  </thead>\n\n  <tbody>\n          <tr>\n\n\t<td>4: 00 PM</td>\n\t\n\t\t  <td  title=\"\"\n\t      id=\"w1d0h16\"\n\t      class=\"selected-time\">\n\t      <input checked=\"checked\" id=\"times[2006-11-26][16]\" name=\"times[2006-11-26][16]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d1h16\"\n\t      class=\"selected-time\">\n\t      <input checked=\"checked\" id=\"times[2006-11-27][16]\" name=\"times[2006-11-27][16]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\n\t\t  <td  title=\"\"\n\t      id=\"w1d2h16\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-28][16]\" name=\"times[2006-11-28][16]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d3h16\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-29][16]\" name=\"times[2006-11-29][16]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d4h16\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-30][16]\" name=\"times[2006-11-30][16]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t      </tr>\n          <tr>\n\t<td>5: 00 PM</td>\n\t\n\t\t  <td  title=\"\"\n\t      id=\"w1d0h17\"\n\t      class=\"selected-time\">\n\t      <input checked=\"checked\" id=\"times[2006-11-26][17]\" name=\"times[2006-11-26][17]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\n\t\t  <td  title=\"\"\n\t      id=\"w1d1h17\"\n\t      class=\"selected-time\">\n\t      <input checked=\"checked\" id=\"times[2006-11-27][17]\" name=\"times[2006-11-27][17]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d2h17\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-28][17]\" name=\"times[2006-11-28][17]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d3h17\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-29][17]\" name=\"times[2006-11-29][17]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d4h17\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-30][17]\" name=\"times[2006-11-30][17]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t      </tr>\n          <tr>\n\t<td>6: 00 PM</td>\n\n\t\n\t\t  <td  title=\"\"\n\t      id=\"w1d0h18\"\n\t      class=\"selected-time\">\n\t      <input checked=\"checked\" id=\"times[2006-11-26][18]\" name=\"times[2006-11-26][18]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d1h18\"\n\t      class=\"selected-time\">\n\t      <input checked=\"checked\" id=\"times[2006-11-27][18]\" name=\"times[2006-11-27][18]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d2h18\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-28][18]\" name=\"times[2006-11-28][18]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d3h18\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-29][18]\" name=\"times[2006-11-29][18]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d4h18\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-30][18]\" name=\"times[2006-11-30][18]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\n\t      </tr>\n          <tr>\n\t<td>7: 00 PM</td>\n\t\n\t\t  <td  title=\"\"\n\t      id=\"w1d0h19\"\n\t      class=\"selected-time\">\n\t      <input checked=\"checked\" id=\"times[2006-11-26][19]\" name=\"times[2006-11-26][19]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d1h19\"\n\t      class=\"selected-time\">\n\t      <input checked=\"checked\" id=\"times[2006-11-27][19]\" name=\"times[2006-11-27][19]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d2h19\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-28][19]\" name=\"times[2006-11-28][19]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t\t  <td  title=\"\"\n\t      id=\"w1d3h19\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-29][19]\" name=\"times[2006-11-29][19]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\n\t\t  <td  title=\"\"\n\t      id=\"w1d4h19\"\n\t      class=\"deselected-time\">\n\t      <input id=\"times[2006-11-30][19]\" name=\"times[2006-11-30][19]\" type=\"checkbox\" value=\"1\" />\n\n\t  </td>\n\t      </tr>\n      </tbody>\n</table>\n\n<div id='select-rect' style='position:  absolute; display:  none; background-color:  #feffd2; opacity:  0.5; border:  1px #ffce05 solid;'\n     onmousemove=\"moveWeek(event);\" onmouseup=\"releaseWeek();\"></div>\n\n<script\n   src=\"http: //concour.se/javascripts/prototype.js\"\n   type=\"text/javascript\"></script>\n\n<script\n   src=\"http: //concour.se/javascripts/effects.js\"\n   type=\"text/javascript\"></script>\n\n<script type=\"text/javascript\">\n//<![CDATA[\ntoggleCheckboxes();\nmadrobbyDisableSelection();\n\nvar selectedColor = '#DDEEFF';\nvar deselectedColor = '#BBCCEE';\nvar dragging;\nvar dragStartPos;\nvar dragStartElement;\nvar dragEndElement;\nvar dragStartState;\n\nfunction clickWeek(event){\n  if(!event) { event = window.event; } // for IE compatibility\n  if(isCell(Event.element(event))){\n    dragging = true;\n    dragStartPos = adjustedCoords(event);\n    dragStartElement = Event.element(event);\n    dragStartState = cellCheckbox(dragStartElement).checked;\n    drawRegion(dragStartPos,  dragStartPos,  event);\n  }\n  else {releaseWeek();}\n}\n\nfunction moveWeek(event){\n  if(!event) { event = window.event; } // for IE compatibility\n  if(dragging) {\n    drawRegion(dragStartPos,  adjustedCoords(event),  event);\n  }\n  return false;\n}\n\nfunction releaseWeek(){\n  if(dragging){\n    dragging = false;\n    Element.hide($('select-rect'));\n    selectRegion(dragStartElement,  dragEndElement);\n  }\n}\n\nfunction drawRegion(start,  end,  event){\n  if(outOfBounds(event)){ return; }\n  dragEndElement = Event.element(event);\n  Element.show($('select-rect'));\n\n  $('select-rect').style.top = Math.min(start[1],  end[1]) + \"px\";\n  $('select-rect').style.height = Math.abs(start[1] - end[1]) + \"px\";\n  $('select-rect').style.left = Math.min(start[0],  end[0]) + \"px\";\n  $('select-rect').style.width = Math.abs(start[0] - end[0]) + \"px\";\n}\n\nfunction selectRegion(start,  end){\n  $R(Math.min(cellHour(start),  cellHour(end)),  Math.max(cellHour(start),  cellHour(end))).each(function(hour) {\n      $R(Math.min(cellDay(start),  cellDay(end)),  Math.max(cellDay(start),  cellDay(end))).each(function(day) {\n\t  selectCell($('w' + cellWeek(start) + 'd' + day + 'h' + hour));\n\t})\n\t})\n}\n\nfunction selectCell(cell){\n  new Effect.Highlight(cell);\n  if(dragStartState){\n    // Browser bug:  changing class does not always change color!\n    cell.style.backgroundColor = deselectedColor;\n//    if(cellCheckbox(cell).checked && cellCount(cell).innerHTML > '0') {cellCount(cell).innerHTML = parseInt(cellCount(cell).innerHTML) - 1;}\n    }\n  else{\n    cell.style.backgroundColor = selectedColor;\n//    if(!cellCheckbox(cell).checked) {cellCount(cell).innerHTML = parseInt(cellCount(cell).innerHTML) + 1;}\n  }\n  cellCheckbox(cell).checked = !dragStartState;\n}\n\n\nfunction adjustedCoords(event){ // get absolute coords rather than relative to scrolling\n  return [Event.pointerX(event),  Event.pointerY(event)];\n}\n\nfunction outOfBounds(event) {\n  if (!isCell(Event.element(event)) || !isCell(dragStartElement)) {return true;}\n  if (cellWeek(dragStartElement) != cellWeek(Event.element(event))) { return true; }\n}\n\nfunction isCell(elem) {\n  if(!elem) { return false; }\n  return !! elem.id.match(/w\\d+d\\d+h\\d+/);\n}\n\nfunction cellWeek(cell) {\n  return parseInt(cell.id.match(/w(\\d*)/)[1]);\n}\n\nfunction cellDay(cell) {\n  return parseInt(cell.id.match(/d(\\d*)/)[1]);\n}\n\nfunction cellHour(cell) {\n  return parseInt(cell.id.match(/h(\\d*)/)[1]);\n}\n\nfunction disableSelection(element) {\n    element.onselectstart = function() {\n        return false;\n    };\n    element.unselectable = \"on\";\n    element.style.MozUserSelect = \"none\";\n    element.style.cursor = \"default\";\n}\n\nfunction madrobbyDisableSelection() {\n  if(/MSIE/.test(navigator.userAgent)) {\n    document.onselectstart = function(event) {\n      if(/td/i.test(Event.element(window.event).tagName))\n\treturn false;\n    };\n  } else { // assume DOM\n    document.onmousedown = function(event) {\n      if(/td/i.test(Event.element(event).tagName))\n\treturn false;\n    };\n  }\n}\n\nfunction fixColor(elem) {\n  // this is necessary because a refresh will reset the colors but keep the checkboxes the same\n  elem.style.backgroundColor = elem.childNodes[1].checked ? selectedColor :  deselectedColor;\n}\n\nfunction toggleCheckboxes() {\n  $$('table input').each(function(c){Element.toggle(c)});\n}\n\nfunction cellCheckbox(cell) {\n  return $$(\"#\" + cell.id + \" input\")[0];\n}\n\nfunction cellCount(cell) {\n  return $$(\"#\" + cell.id + \" span\")[0];\n}\n//]]>\n</script>\n\n<p><b>Update</b>:  Aggregators seem to be stripping out the fancy JS, \nso if you see a bunch of checkboxes,  you're seeing the degraded\nversion. <a href='http: //technomancy.us/blog/post/66'>See the\noriginal</a>.</p>\n\n<p>Before this was implemented,  my poor users had to click a separate\ncheckbox for each hour they wanted to select. Clearly sub-optimal! Now\nthey can bask in the shininess of Javascript. <strike>Provided,  of course, \nthat they're using a Gecko-based browser. Support for IE and KHTML is\nstill in the works</strike>.</p>\n\n<p><b>Update</b>:  IE,  Konqueror,  and Safari are now supported.</p>\n\n<p>Other than that,  the remaining work is quite trivial. Spread\nthe word. Several people I've mentioned this to have responded with\nsomething along the lines of,  \"Oh... I really need something that can\ndo that!\" This provided the motivation for me to dust off the old\nrepository and get cracking.</p>\n\n<p>The biggest thing about developing in Javascript that really annoys\nme is that it's very difficult to do without using the mouse. Ever\nsince switching to <a href='http: //sawmill.sf.net'>the Sawfish window\nmanager</a> I've been quite spoiled by my newfound ability to do\nnearly everything from the keyboard--but Javascript wrecks this,  and\nI've got an ache in my shoulder to prove it. Hopefully once I dig into\nsome <a\nhref='http: //mir.aculo.us/2006/9/16/adventures-in-javascript-testing'>unit\ntesting for Javascript</a>,  things will improve.</p>\n"}
