{"timestamp":"Sat Oct 13 00:00:01 -0700 2007","title":"arorem hacks","id":54,"content":"<a href=\"http:\/\/safetystate.com\/ss.cgi?action=material&id=31\"><img\n\t\tsrc=\"\/static\/i\/patents.png\" alt=\n\t\t\"software patents - because extortionists are people\n\t\ttoo.\" \/><\/a>\n\n<p>I've been\n  improving <a\n\t       href=\"http:\/\/dev.technomancy.us\/phil\/wiki\/arorem\">arorem<\/a>\n  a bit these past few days, and this little snippet has come in very\n  handy:<\/p>\n\n    <pre>\n(<span class=\"keyword\">defvar<\/span> <span class=\"variable-name\">project-files-table<\/span> ())\n\n(<span class=\"keyword\">defun<\/span> <span class=\"function-name\">populate-project-files-table<\/span> (file)\n  (<span class=\"keyword\">if<\/span> (file-directory-p file)\n      (mapc 'populate-project-files-table (directory-files file t <span class=\"string\">\"^[<\/span><span class=\"string\"><span class=\"negation-char\">^<\/span><\/span><span class=\"string\">\\.]\"<\/span>))\n    (setq project-files-table (acons (file-name-nondirectory file) file project-files-table))))\n\n(<span class=\"keyword\">defun<\/span> <span class=\"function-name\">find-file-in-project<\/span> (file)\n  (interactive (list (completing-read <span class=\"string\">\"Find file in project: \"<\/span> (mapcar 'car (project-files)))))\n  (find-file (cdr (assoc file project-files-table))))\n\n(<span class=\"keyword\">defun<\/span> <span class=\"function-name\">project-files<\/span> ()\n  (<span class=\"keyword\">when<\/span> (or (not project-files-table) <span class=\"comment-delimiter\">; <\/span><span class=\"comment\">initial load\n<\/span>            (not (string-match (rails-root) (cdar project-files-table)))) <span class=\"comment-delimiter\">; <\/span><span class=\"comment\">switched projects\n<\/span>    (setq project-files-table nil)\n    (populate-project-files-table (concat (rails-root) <span class=\"string\">\"\/app\"<\/span>)))\n  project-files-table)\n\n\n(<span class=\"keyword\">defun<\/span> <span class=\"function-name\">rails-root<\/span> (<span class=\"type\">&amp;optional<\/span> dir)\n  (or dir (setq dir default-directory))\n  (<span class=\"keyword\">if<\/span> (file-exists-p (concat dir <span class=\"string\">\"config\/environment.rb\"<\/span>))\n      dir\n    (<span class=\"keyword\">if<\/span> (equal dir  <span class=\"string\">\"\/\"<\/span>)\n        nil\n      (rails-root (expand-file-name (concat dir <span class=\"string\">\"..\/\"<\/span>))))))\n<\/pre>\n"}
